<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <link rel="icon" href="https://res.cloudinary.com/dcajb02df/image/upload/v1753960691/logo_pyncju.png" type="image/png"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Passport Photo Generator</title>
  <style>
    :root {
      --primary: #007bff;
      --bg: #f5f5f5;
      --light: #ffffff;
      --accent: #e3f2fd;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: var(--bg);
      padding-bottom: 100px;
    }

    header {
      background: var(--primary);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    #loginBtn {
      background: white;
      color: var(--primary);
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 5px;
      font-weight: bold;
      transition: background 0.3s;
    }

    #loginBtn:hover {
      background: #e6e6e6;
    }

    .container {
      max-width: 700px;
      margin: 2rem auto;
      padding: 2rem;
      background: var(--light);
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      text-align: center;
    }

    .drop-zone {
      border: 2px dashed #aaa;
      border-radius: 10px;
      padding: 2rem;
      cursor: pointer;
      background: #fff;
      margin: 1rem auto;
    }

    .drop-zone.dragover {
      background: var(--accent);
    }

    #preview {
      max-width: 300px;
      margin-top: 1rem;
      border: 1px solid #ccc;
      padding: 4px;
      background: #fff;
    }

    .input-group {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .input-group label {
      margin-right: 0.5rem;
    }

    input[type="number"] {
      width: 80px;
      padding: 5px;
      font-size: 16px;
    }

    .advanced {
      display: none;
      margin-top: 1rem;
      border: 1px solid #ccc;
      padding: 1rem;
      background: #f9f9f9;
      border-radius: 6px;
    }

    button {
      margin-top: 1rem;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background: var(--primary);
      color: white;
    }

    .advance {
      background: #71b1fcab;
    }

    button:disabled {
      background: #ccc;
    }

    #loading {
      display: none;
      font-weight: bold;
      margin-top: 1rem;
      color: var(--primary);
    }

    #pdfPreview {
      display: none;
      width: 100%;
      height: 500px;
      margin-top: 1rem;
    }

    #feedbackBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 50px;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      z-index: 999;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
    }

    .modal-content textarea {
      width: 100%;
      height: 120px;
      margin-top: 1rem;
      padding: 10px;
      font-size: 15px;
    }

    .modal-content button {
      margin-top: 1rem;
      background: var(--primary);
    }

    .close-modal {
      float: right;
      font-size: 20px;
      cursor: pointer;
      color: #888;
    }
  </style>
</head>
<body>
  <header>
    <h1>Passport Photo Generator</h1>
    <a href="/login" id="loginBtn">Premium</a>
  </header>

  <div class="container">
    <div class="drop-zone" id="dropZone">
      Drag & Drop Your Cropped Image Here or Click to Upload
      <input type="file" id="imageInput" name="image" accept="image/*" style="display: none;" />
    </div>

    <img id="preview" src="" alt="Image preview" />
    <embed id="pdfPreview" type="application/pdf" />

    <div class="input-group">
      <label for="copies">Copies:</label>
      <input type="number" id="copies" value="1" min="1" max="54" />
    </div>

    <button type="button" class="advance" id="toggleAdvanced">Show Advanced Options</button>

    <div class="advanced" id="advancedOptions">
      <div class="input-group">
        <label for="width">Width:</label>
        <input type="number" id="width" value="400" />
        <label for="height">Height:</label>
        <input type="number" id="height" value="400" />
        <label for="spacing">Spacing:</label>
        <input type="number" id="spacing" value="50" />
        <label for="border">Border:</label>
        <input type="number" id="border" value="5" />
      </div>
    </div>

    <button type="button" id="generateBtn">Generate Passport Sheet</button>
    <div id="loading">Processing image... please wait</div>
    <button id="downloadBtn" style="display: none;">Download Passport Sheet</button>
  </div>

  <button id="feedbackBtn">Feedback / Bug Report</button>

  <div class="modal" id="feedbackModal">
    <div class="modal-content">
      <span class="close-modal" id="closeModal">&times;</span>
      <h2>Feedback or Bug Report</h2>
      <form id="feedbackForm" style="margin-top: 1rem;">
  <label for="contact" style="display: block; font-weight: bold;">Your Contact (Email or Phone) <span style="color: red">*</span></label>
  <input type="text" name="contact" id="contact" placeholder="e.g. john@example.com or +91-9876543210" required style="width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 1rem; font-size: 15px;">

  <label for="message" style="display: block; font-weight: bold;">Your Feedback or Bug Report <span style="color: red">*</span></label>
  <textarea name="message" id="message" placeholder="Describe your issue or suggestion in detail..." required style="width: 100%; height: 120px; padding: 10px; font-size: 15px;"></textarea>

  <button type="submit" style="margin-top: 1rem;">Submit</button>
</form>

    </div>
  </div>

  <!-- Include EmailJS SDK -->
  
  <script>
    emailjs.init("XJqjmVHK4ISEX0Zam"); // Replace with your EmailJS public key

    const dropZone = document.getElementById('dropZone');
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const pdfPreview = document.getElementById('pdfPreview');
    const loading = document.getElementById('loading');
    const downloadBtn = document.getElementById('downloadBtn');
    const copiesInput = document.getElementById('copies');
    const widthInput = document.getElementById('width');
    const heightInput = document.getElementById('height');
    const spacingInput = document.getElementById('spacing');
    const borderInput = document.getElementById('border');
    const generateBtn = document.getElementById('generateBtn');
    const toggleBtn = document.getElementById('toggleAdvanced');
    const advancedDiv = document.getElementById('advancedOptions');

    let selectedFile = null;

    toggleBtn.addEventListener('click', () => {
      const visible = advancedDiv.style.display === 'block';
      advancedDiv.style.display = visible ? 'none' : 'block';
      toggleBtn.textContent = visible ? 'Show Advanced Options' : 'Hide Advanced Options';
    });

    dropZone.addEventListener('click', () => imageInput.click());
    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    imageInput.addEventListener('change', () => {
      const file = imageInput.files[0];
      if (file) handleFile(file);
    });

    function handleFile(file) {
      selectedFile = file;
      preview.src = URL.createObjectURL(file);
    }

    generateBtn.addEventListener('click', () => {
      if (!selectedFile) return alert("Please upload an image first.");

      const formData = new FormData();
      formData.append('image', selectedFile);
      formData.append('copies', copiesInput.value);
      formData.append('width', widthInput.value);
      formData.append('height', heightInput.value);
      formData.append('spacing', spacingInput.value);
      formData.append('border', borderInput.value);

      loading.style.display = 'block';
      downloadBtn.style.display = 'none';

      fetch('/process', { method: 'POST', body: formData })
        .then(async response => {
          if (response.status === 429) {
            const html = await response.text();
            document.body.innerHTML = html;
            return;
          }
          if (!response.ok) throw new Error("Processing failed");
          return response.blob();
        })
        .then(blob => {
          if (!blob) return;
          loading.style.display = 'none';
          const url = URL.createObjectURL(blob);
          pdfPreview.style.display = 'block';
          pdfPreview.src = url;

          downloadBtn.style.display = 'inline-block';
          downloadBtn.onclick = () => {
            const link = document.createElement('a');
            link.href = url;
            link.download = 'passport-sheet.pdf';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          };
        })
        .catch(() => {
          loading.style.display = 'none';
          alert("Image processing failed.");
        });
    });

    // Feedback modal logic
    const feedbackBtn = document.getElementById('feedbackBtn');
    const feedbackModal = document.getElementById('feedbackModal');
    const closeModal = document.getElementById('closeModal');
    const feedbackForm = document.getElementById('feedbackForm');

    feedbackBtn.onclick = () => feedbackModal.style.display = 'flex';
    closeModal.onclick = () => feedbackModal.style.display = 'none';

    feedbackForm.onsubmit = e => {
  e.preventDefault();

  const contact = feedbackForm.contact.value.trim();
  const message = feedbackForm.message.value.trim();

  if (!contact || !message) {
    return alert("Please fill out both contact and message fields.");
  }

  emailjs.send("service_aoewzsq", "template_hbw13lt", {
    contact: contact,
    message: message,
    user_agent: navigator.userAgent,
    time: new Date().toLocaleString()
  })
  .then(() => {
    alert("Thank you! Your feedback has been submitted.");
    feedbackModal.style.display = 'none';
    feedbackForm.reset();
  })
  .catch(() => {
    alert("Failed to send feedback. Please try again later.");
  });
};

  </script>
</body>
</html>
